<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recettes de la Semaine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <div class="container">
        <header class="header">
            <a href="index.html" class="nav-link">
                <i class="fas fa-arrow-left"></i> Retour à l'inventaire
            </a>
            <h1><i class="fas fa-utensils"></i> Recettes de la Semaine</h1>
            <p>Planifiez vos déjeuners et dîners en fonction de votre inventaire</p>
        </header>

        <main class="main-content">
            <!-- Section d'ajout de recette -->
            <section class="add-recipe-section">
                <h2><i class="fas fa-plus-circle"></i> Ajouter une recette</h2>
                <form id="add-recipe-form" class="add-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="recipe-name">Nom de la recette</label>
                            <input type="text" id="recipe-name" required
                                placeholder="Ex: Pâtes carbonara, Salade césar...">
                        </div>
                        <div class="form-group">
                            <label for="recipe-type">Type</label>
                            <select id="recipe-type" required>
                                <option value="">Choisir un type</option>
                                <option value="dejeuner">Déjeuner</option>
                                <option value="diner">Dîner</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="recipe-instructions">Instructions</label>
                        <textarea id="recipe-instructions" rows="3"
                            placeholder="Décrivez les étapes de préparation..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ingrédients</label>
                        <div id="ingredients-container">
                            <div class="ingredient-row">
                                <div class="form-row">
                                    <div class="form-group">
                                        <input type="text" class="ingredient-name" placeholder="Nom (ex: Pâtes)"
                                            required>
                                    </div>
                                    <div class="form-group">
                                        <input type="number" class="ingredient-quantity" min="0" placeholder="Quantité"
                                            required>
                                    </div>
                                    <div class="form-group">
                                        <select class="ingredient-unit" required>
                                            <option value="">Unité</option>
                                            <option value="pièces">Pièces</option>
                                            <option value="kg">Kilogrammes</option>
                                            <option value="g">Grammes</option>
                                            <option value="L">Litres</option>
                                            <option value="mL">Millilitres</option>
                                            <option value="boîtes">Boîtes</option>
                                            <option value="paquets">Paquets</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" id="add-ingredient" class="btn btn-outline">
                            <i class="fas fa-plus"></i> Ajouter un ingrédient
                        </button>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ajouter la recette
                    </button>
                </form>
            </section>

            <!-- Section des recettes -->
            <section class="recipes-section">
                <div class="search-controls">
                    <div class="search-group">
                        <input type="text" id="search-recipe" placeholder="Rechercher une recette...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <div class="filter-group">
                        <select id="filter-type">
                            <option value="all">Toutes les recettes</option>
                            <option value="dejeuner">Déjeuner</option>
                            <option value="diner">Dîner</option>
                        </select>
                    </div>
                </div>

                <div id="recipes-grid" class="recipes-grid">
                    <!-- Les recettes seront ajoutées ici dynamiquement -->
                </div>
            </section>

            <!-- Section de la semaine -->
            <section class="week-section">
                <h2><i class="fas fa-calendar-week"></i> Planification de la Semaine</h2>
                <div class="week-grid">
                    <!-- Lundi -->
                    <div class="day-card">
                        <div class="day-header">Lundi</div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-sun"></i> Déjeuner</div>
                            <div id="monday-lunch" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('monday', 'lunch')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-moon"></i> Dîner</div>
                            <div id="monday-dinner" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('monday', 'dinner')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mardi -->
                    <div class="day-card">
                        <div class="day-header">Mardi</div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-sun"></i> Déjeuner</div>
                            <div id="tuesday-lunch" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('tuesday', 'lunch')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-moon"></i> Dîner</div>
                            <div id="tuesday-dinner" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('tuesday', 'dinner')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mercredi -->
                    <div class="day-card">
                        <div class="day-header">Mercredi</div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-sun"></i> Déjeuner</div>
                            <div id="wednesday-lunch" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('wednesday', 'lunch')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-moon"></i> Dîner</div>
                            <div id="wednesday-dinner" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('wednesday', 'dinner')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Jeudi -->
                    <div class="day-card">
                        <div class="day-header">Jeudi</div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-sun"></i> Déjeuner</div>
                            <div id="thursday-lunch" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('thursday', 'lunch')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-moon"></i> Dîner</div>
                            <div id="thursday-dinner" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('thursday', 'dinner')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Vendredi -->
                    <div class="day-card">
                        <div class="day-header">Vendredi</div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-sun"></i> Déjeuner</div>
                            <div id="friday-lunch" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('friday', 'lunch')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-moon"></i> Dîner</div>
                            <div id="friday-dinner" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('friday', 'dinner')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Samedi -->
                    <div class="day-card">
                        <div class="day-header">Samedi</div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-sun"></i> Déjeuner</div>
                            <div id="saturday-lunch" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('saturday', 'lunch')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-moon"></i> Dîner</div>
                            <div id="saturday-dinner" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('saturday', 'dinner')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Dimanche -->
                    <div class="day-card">
                        <div class="day-header">Dimanche</div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-sun"></i> Déjeuner</div>
                            <div id="sunday-lunch" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('sunday', 'lunch')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="meal-section">
                            <div class="meal-title"><i class="fas fa-moon"></i> Dîner</div>
                            <div id="sunday-dinner" class="meal-content"></div>
                            <div class="meal-actions">
                                <button class="btn btn-small btn-primary"
                                    onclick="openRecipeSelector('sunday', 'dinner')">
                                    <i class="fas fa-plus"></i> Ajouter
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section des suggestions d'achat -->
            <section class="suggestions-section">
                <h2><i class="fas fa-shopping-cart"></i> Suggestions d'Achat</h2>
                <p>Articles nécessaires pour préparer toutes les recettes planifiées</p>
                <div id="suggestions-list" class="suggestions-list">
                    <div class="suggestion-item">
                        <div class="suggestion-info">
                            <i class="fas fa-shopping-basket"></i>
                            <span>Planifiez vos recettes pour voir les suggestions d'achat</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal pour sélectionner une recette -->
    <div id="recipe-selector-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-list"></i> Sélectionnez une recette</h3>
                <button class="close-btn" id="close-selector-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="selector-recipes-list" class="recipes-grid">
                    <!-- Les recettes seront ajoutées ici dynamiquement -->
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-selector">
                    Annuler
                </button>
            </div>
        </div>
    </div>

    <!-- Modal pour modifier une recette -->
    <div id="edit-recipe-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Modifier la recette</h3>
                <button class="close-btn" id="close-edit-modal">&times;</button>
            </div>
            <form id="edit-recipe-form" class="add-form">
                <input type="hidden" id="edit-recipe-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-recipe-name">Nom de la recette</label>
                        <input type="text" id="edit-recipe-name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-recipe-type">Type</label>
                        <select id="edit-recipe-type" required>
                            <option value="dejeuner">Déjeuner</option>
                            <option value="diner">Dîner</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-recipe-instructions">Instructions</label>
                    <textarea id="edit-recipe-instructions" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Ingrédients</label>
                    <div id="edit-ingredients-container">
                        <!-- Les ingrédients seront ajoutés ici dynamiquement -->
                    </div>
                    <button type="button" id="add-edit-ingredient" class="btn btn-outline">
                        <i class="fas fa-plus"></i> Ajouter un ingrédient
                    </button>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-edit">Annuler</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Données de démonstration
        const sampleRecipes = [
            {
                id: 1,
                name: "Pâtes Carbonara",
                type: "diner",
                instructions: "1. Cuire les pâtes al dente\n2. Faire revenir les lardons\n3. Mélanger les œufs et le parmesan\n4. Tout mélanger hors du feu",
                ingredients: [
                    { name: "Pâtes", quantity: 250, unit: "g" },
                    { name: "Lardons", quantity: 150, unit: "g" },
                    { name: "Œufs", quantity: 2, unit: "pièces" },
                    { name: "Parmesan", quantity: 50, unit: "g" }
                ]
            },
            {
                id: 2,
                name: "Salade César",
                type: "dejeuner",
                instructions: "1. Laver et couper la salade\n2. Préparer la vinaigrette\n3. Griller les croûtons\n4. Ajouter le poulet et le parmesan",
                ingredients: [
                    { name: "Laitue", quantity: 1, unit: "pièces" },
                    { name: "Poulet", quantity: 200, unit: "g" },
                    { name: "Croûtons", quantity: 50, unit: "g" },
                    { name: "Parmesan", quantity: 30, unit: "g" }
                ]
            },
            {
                id: 3,
                name: "Omelette aux légumes",
                type: "dejeuner",
                instructions: "1. Battre les œufs\n2. Couper les légumes\n3. Faire revenir les légumes\n4. Ajouter les œufs et cuire",
                ingredients: [
                    { name: "Œufs", quantity: 3, unit: "pièces" },
                    { name: "Poivron", quantity: 1, unit: "pièces" },
                    { name: "Oignon", quantity: 1, unit: "pièces" },
                    { name: "Tomate", quantity: 1, unit: "pièces" }
                ]
            },
            {
                id: 4,
                name: "Poulet rôti",
                type: "diner",
                instructions: "1. Préchauffer le four à 200°C\n2. Assaisonner le poulet\n3. Enfourner pendant 1h\n4. Servir avec des légumes",
                ingredients: [
                    { name: "Poulet", quantity: 1, unit: "pièces" },
                    { name: "Pommes de terre", quantity: 500, unit: "g" },
                    { name: "Carottes", quantity: 4, unit: "pièces" }
                ]
            }
        ];

        // Planification de la semaine
        let weekPlan = {
            monday: { lunch: null, dinner: 1 },
            tuesday: { lunch: 2, dinner: null },
            wednesday: { lunch: null, dinner: null },
            thursday: { lunch: null, dinner: null },
            friday: { lunch: null, dinner: null },
            saturday: { lunch: null, dinner: null },
            sunday: { lunch: null, dinner: null }
        };

        // Gestion des recettes
        let recipes = [...sampleRecipes];
        let currentDay = '';
        let currentMeal = '';

        // DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function () {
            // Initialisation
            renderRecipes();
            renderWeekPlan();
            generateShoppingSuggestions();

            // Gestion des formulaires
            document.getElementById('add-recipe-form').addEventListener('submit', addRecipe);
            document.getElementById('edit-recipe-form').addEventListener('submit', updateRecipe);

            // Bouton pour ajouter un ingrédient
            document.getElementById('add-ingredient').addEventListener('click', addIngredientRow);
            document.getElementById('add-edit-ingredient').addEventListener('click', addEditIngredientRow);

            // Recherche et filtres
            document.getElementById('search-recipe').addEventListener('input', filterRecipes);
            document.getElementById('filter-type').addEventListener('change', filterRecipes);

            // Fermeture des modales
            document.getElementById('close-selector-modal').addEventListener('click', closeSelectorModal);
            document.getElementById('cancel-selector').addEventListener('click', closeSelectorModal);
            document.getElementById('close-edit-modal').addEventListener('click', closeEditModal);
            document.getElementById('cancel-edit').addEventListener('click', closeEditModal);
        });

        // Rendu des recettes
        function renderRecipes() {
            const container = document.getElementById('recipes-grid');
            container.innerHTML = '';

            recipes.forEach(recipe => {
                const card = document.createElement('div');
                card.className = 'recipe-card';

                const typeLabel = recipe.type === 'dejeuner' ? 'Déjeuner' : 'Dîner';

                card.innerHTML = `
                    <div class="recipe-header">
                        <h3>${recipe.name}</h3>
                        <span class="recipe-type">${typeLabel}</span>
                    </div>
                    <div class="recipe-body">
                        <div class="recipe-ingredients">
                            <h4><i class="fas fa-carrot"></i> Ingrédients</h4>
                            <ul class="ingredient-list">
                                ${recipe.ingredients.map(ing =>
                    `<li class="ingredient-item">
                                        <span>${ing.name}</span>
                                        <span>${ing.quantity} ${ing.unit}</span>
                                    </li>`
                ).join('')}
                            </ul>
                        </div>
                        ${recipe.instructions ? `
                        <div class="recipe-instructions">
                            <h4><i class="fas fa-list-ol"></i> Instructions</h4>
                            <p>${recipe.instructions.replace(/\n/g, '<br>')}</p>
                        </div>
                        ` : ''}
                    </div>
                    <div class="recipe-actions">
                        <button class="btn btn-small btn-primary" onclick="editRecipe(${recipe.id})">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteRecipe(${recipe.id})">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Ajout d'une recette
        function addRecipe(e) {
            e.preventDefault();

            const name = document.getElementById('recipe-name').value.trim();
            const type = document.getElementById('recipe-type').value;
            const instructions = document.getElementById('recipe-instructions').value;

            if (!name || !type) {
                showNotification('Veuillez remplir le nom et le type de recette', 'error');
                return;
            }

            // Récupération des ingrédients
            const ingredients = [];
            const ingredientRows = document.querySelectorAll('#ingredients-container .ingredient-row');

            ingredientRows.forEach(row => {
                const nameInput = row.querySelector('.ingredient-name');
                const quantityInput = row.querySelector('.ingredient-quantity');
                const unitSelect = row.querySelector('.ingredient-unit');

                if (nameInput.value && quantityInput.value && unitSelect.value) {
                    ingredients.push({
                        name: nameInput.value.trim(),
                        quantity: parseFloat(quantityInput.value),
                        unit: unitSelect.value
                    });
                }
            });

            if (ingredients.length === 0) {
                showNotification('Veuillez ajouter au moins un ingrédient', 'error');
                return;
            }

            // Création de la recette
            const newRecipe = {
                id: Date.now(), // ID unique
                name,
                type,
                instructions,
                ingredients
            };

            recipes.push(newRecipe);
            renderRecipes();
            showNotification('Recette ajoutée avec succès', 'success');

            // Réinitialisation du formulaire
            document.getElementById('add-recipe-form').reset();
            document.getElementById('ingredients-container').innerHTML = `
                <div class="ingredient-row">
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="ingredient-name" placeholder="Nom (ex: Pâtes)" required>
                        </div>
                        <div class="form-group">
                            <input type="number" class="ingredient-quantity" min="0" placeholder="Quantité" required>
                        </div>
                        <div class="form-group">
                            <select class="ingredient-unit" required>
                                <option value="">Unité</option>
                                <option value="pièces">Pièces</option>
                                <option value="kg">Kilogrammes</option>
                                <option value="g">Grammes</option>
                                <option value="L">Litres</option>
                                <option value="mL">Millilitres</option>
                                <option value="boîtes">Boîtes</option>
                                <option value="paquets">Paquets</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
        }

        // Ajout d'une ligne d'ingrédient
        function addIngredientRow() {
            const container = document.getElementById('ingredients-container');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row';
            newRow.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <input type="text" class="ingredient-name" placeholder="Nom (ex: Pâtes)" required>
                    </div>
                    <div class="form-group">
                        <input type="number" class="ingredient-quantity" min="0" placeholder="Quantité" required>
                    </div>
                    <div class="form-group">
                        <select class="ingredient-unit" required>
                            <option value="">Unité</option>
                            <option value="pièces">Pièces</option>
                            <option value="kg">Kilogrammes</option>
                            <option value="g">Grammes</option>
                            <option value="L">Litres</option>
                            <option value="mL">Millilitres</option>
                            <option value="boîtes">Boîtes</option>
                            <option value="paquets">Paquets</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(newRow);
        }

        // Ouverture de la modal d'édition
        function editRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;

            document.getElementById('edit-recipe-id').value = recipe.id;
            document.getElementById('edit-recipe-name').value = recipe.name;
            document.getElementById('edit-recipe-type').value = recipe.type;
            document.getElementById('edit-recipe-instructions').value = recipe.instructions;

            // Remplissage des ingrédients
            const container = document.getElementById('edit-ingredients-container');
            container.innerHTML = '';

            recipe.ingredients.forEach(ing => {
                const row = document.createElement('div');
                row.className = 'ingredient-row';
                row.innerHTML = `
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="ingredient-name" value="${ing.name}" required>
                        </div>
                        <div class="form-group">
                            <input type="number" class="ingredient-quantity" min="0" value="${ing.quantity}" required>
                        </div>
                        <div class="form-group">
                            <select class="ingredient-unit" required>
                                <option value="">Unité</option>
                                <option value="pièces" ${ing.unit === 'pièces' ? 'selected' : ''}>Pièces</option>
                                <option value="kg" ${ing.unit === 'kg' ? 'selected' : ''}>Kilogrammes</option>
                                <option value="g" ${ing.unit === 'g' ? 'selected' : ''}>Grammes</option>
                                <option value="L" ${ing.unit === 'L' ? 'selected' : ''}>Litres</option>
                                <option value="mL" ${ing.unit === 'mL' ? 'selected' : ''}>Millilitres</option>
                                <option value="boîtes" ${ing.unit === 'boîtes' ? 'selected' : ''}>Boîtes</option>
                                <option value="paquets" ${ing.unit === 'paquets' ? 'selected' : ''}>Paquets</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-small btn-danger" onclick="this.parentElement.parentElement.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(row);
            });

            openModal('edit-recipe-modal');
        }

        // Ajout d'une ligne d'ingrédient dans la modal d'édition
        function addEditIngredientRow() {
            const container = document.getElementById('edit-ingredients-container');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row';
            newRow.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <input type="text" class="ingredient-name" placeholder="Nom (ex: Pâtes)" required>
                    </div>
                    <div class="form-group">
                        <input type="number" class="ingredient-quantity" min="0" placeholder="Quantité" required>
                    </div>
                    <div class="form-group">
                        <select class="ingredient-unit" required>
                            <option value="">Unité</option>
                            <option value="pièces">Pièces</option>
                            <option value="kg">Kilogrammes</option>
                            <option value="g">Grammes</option>
                            <option value="L">Litres</option>
                            <option value="mL">Millilitres</option>
                            <option value="boîtes">Boîtes</option>
                            <option value="paquets">Paquets</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn btn-small btn-danger" onclick="this.parentElement.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(newRow);
        }

        // Mise à jour d'une recette
        function updateRecipe(e) {
            e.preventDefault();

            const id = parseInt(document.getElementById('edit-recipe-id').value);
            const name = document.getElementById('edit-recipe-name').value.trim();
            const type = document.getElementById('edit-recipe-type').value;
            const instructions = document.getElementById('edit-recipe-instructions').value;

            if (!name || !type) {
                showNotification('Veuillez remplir le nom et le type de recette', 'error');
                return;
            }

            // Récupération des ingrédients
            const ingredients = [];
            const ingredientRows = document.querySelectorAll('#edit-ingredients-container .ingredient-row');

            ingredientRows.forEach(row => {
                const nameInput = row.querySelector('.ingredient-name');
                const quantityInput = row.querySelector('.ingredient-quantity');
                const unitSelect = row.querySelector('.ingredient-unit');

                if (nameInput.value && quantityInput.value && unitSelect.value) {
                    ingredients.push({
                        name: nameInput.value.trim(),
                        quantity: parseFloat(quantityInput.value),
                        unit: unitSelect.value
                    });
                }
            });

            if (ingredients.length === 0) {
                showNotification('Veuillez ajouter au moins un ingrédient', 'error');
                return;
            }

            // Mise à jour de la recette
            const recipeIndex = recipes.findIndex(r => r.id === id);

            if (recipeIndex !== -1) {
                recipes[recipeIndex] = {
                    id,
                    name,
                    type,
                    instructions,
                    ingredients
                };

                renderRecipes();
                renderWeekPlan();
                generateShoppingSuggestions();
                showNotification('Recette mise à jour avec succès', 'success');
                closeEditModal();
            }
        }

        // Suppression d'une recette
        function deleteRecipe(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette recette ?')) {
                recipes = recipes.filter(r => r.id !== id);

                // Retirer la recette de la planification
                for (const day in weekPlan) {
                    for (const meal in weekPlan[day]) {
                        if (weekPlan[day][meal] === id) {
                            weekPlan[day][meal] = null;
                        }
                    }
                }

                renderRecipes();
                renderWeekPlan();
                generateShoppingSuggestions();
                showNotification('Recette supprimée avec succès', 'success');
            }
        }

        // Filtrage des recettes
        function filterRecipes() {
            const searchTerm = document.getElementById('search-recipe').value.toLowerCase();
            const typeFilter = document.getElementById('filter-type').value;

            const filteredRecipes = recipes.filter(recipe => {
                const matchesSearch = recipe.name.toLowerCase().includes(searchTerm);
                const matchesType = typeFilter === 'all' || recipe.type === typeFilter;

                return matchesSearch && matchesType;
            });

            const container = document.getElementById('recipes-grid');
            container.innerHTML = '';

            if (filteredRecipes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-utensils"></i>
                        <h3>Aucune recette trouvée</h3>
                        <p>Essayez de modifier vos critères de recherche</p>
                    </div>
                `;
                return;
            }

            filteredRecipes.forEach(recipe => {
                const card = document.createElement('div');
                card.className = 'recipe-card';

                const typeLabel = recipe.type === 'dejeuner' ? 'Déjeuner' : 'Dîner';

                card.innerHTML = `
                    <div class="recipe-header">
                        <h3>${recipe.name}</h3>
                        <span class="recipe-type">${typeLabel}</span>
                    </div>
                    <div class="recipe-body">
                        <div class="recipe-ingredients">
                            <h4><i class="fas fa-carrot"></i> Ingrédients</h4>
                            <ul class="ingredient-list">
                                ${recipe.ingredients.map(ing =>
                    `<li class="ingredient-item">
                                        <span>${ing.name}</span>
                                        <span>${ing.quantity} ${ing.unit}</span>
                                    </li>`
                ).join('')}
                            </ul>
                        </div>
                        ${recipe.instructions ? `
                        <div class="recipe-instructions">
                            <h4><i class="fas fa-list-ol"></i> Instructions</h4>
                            <p>${recipe.instructions.replace(/\n/g, '<br>')}</p>
                        </div>
                        ` : ''}
                    </div>
                    <div class="recipe-actions">
                        <button class="btn btn-small btn-primary" onclick="editRecipe(${recipe.id})">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteRecipe(${recipe.id})">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Rendu de la planification de la semaine
        function renderWeekPlan() {
            for (const day in weekPlan) {
                for (const meal in weekPlan[day]) {
                    const container = document.getElementById(`${day}-${meal}`);
                    const recipeId = weekPlan[day][meal];

                    if (recipeId) {
                        const recipe = recipes.find(r => r.id === recipeId);
                        if (recipe) {
                            container.innerHTML = `
                                <h4>${recipe.name}</h4>
                                <p><small>${recipe.ingredients.length} ingrédients</small></p>
                                <button class="btn btn-small btn-danger" onclick="removeRecipeFromPlan('${day}', '${meal}')">
                                    <i class="fas fa-times"></i> Retirer
                                </button>
                            `;
                        } else {
                            container.innerHTML = '';
                            weekPlan[day][meal] = null;
                        }
                    } else {
                        container.innerHTML = '';
                    }
                }
            }
        }

        // Ouverture du sélecteur de recettes
        function openRecipeSelector(day, meal) {
            currentDay = day;
            currentMeal = meal;

            const container = document.getElementById('selector-recipes-list');
            container.innerHTML = '';

            const filteredRecipes = recipes.filter(r => r.type === (meal === 'lunch' ? 'dejeuner' : 'diner'));

            if (filteredRecipes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-utensils"></i>
                        <h3>Aucune recette disponible</h3>
                        <p>Créez d'abord des recettes pour ${meal === 'lunch' ? 'déjeuner' : 'dîner'}</p>
                    </div>
                `;
            } else {
                filteredRecipes.forEach(recipe => {
                    const card = document.createElement('div');
                    card.className = 'recipe-card';

                    card.innerHTML = `
                        <div class="recipe-header">
                            <h3>${recipe.name}</h3>
                        </div>
                        <div class="recipe-body">
                            <div class="recipe-ingredients">
                                <h4><i class="fas fa-carrot"></i> Ingrédients</h4>
                                <ul class="ingredient-list">
                                    ${recipe.ingredients.slice(0, 3).map(ing =>
                        `<li class="ingredient-item">
                                            <span>${ing.name}</span>
                                            <span>${ing.quantity} ${ing.unit}</span>
                                        </li>`
                    ).join('')}
                                    ${recipe.ingredients.length > 3 ? `<li>... et ${recipe.ingredients.length - 3} de plus</li>` : ''}
                                </ul>
                            </div>
                        </div>
                        <div class="recipe-actions">
                            <button class="btn btn-small btn-primary" onclick="selectRecipe(${recipe.id})">
                                <i class="fas fa-check"></i> Sélectionner
                            </button>
                        </div>
                    `;

                    container.appendChild(card);
                });
            }

            openModal('recipe-selector-modal');
        }

        // Sélection d'une recette pour la planification
        function selectRecipe(id) {
            weekPlan[currentDay][currentMeal] = id;
            renderWeekPlan();
            generateShoppingSuggestions();
            closeSelectorModal();
            showNotification('Recette ajoutée à la planification', 'success');
        }

        // Retrait d'une recette de la planification
        function removeRecipeFromPlan(day, meal) {
            weekPlan[day][meal] = null;
            renderWeekPlan();
            generateShoppingSuggestions();
            showNotification('Recette retirée de la planification', 'success');
        }

        // Génération des suggestions d'achat
        function generateShoppingSuggestions() {
            const shoppingList = {};

            // Parcourir tous les jours et repas planifiés
            for (const day in weekPlan) {
                for (const meal in weekPlan[day]) {
                    const recipeId = weekPlan[day][meal];
                    if (recipeId) {
                        const recipe = recipes.find(r => r.id === recipeId);
                        if (recipe) {
                            // Ajouter chaque ingrédient à la liste de courses
                            recipe.ingredients.forEach(ing => {
                                const key = `${ing.name}|${ing.unit}`;
                                if (shoppingList[key]) {
                                    shoppingList[key].quantity += ing.quantity;
                                } else {
                                    shoppingList[key] = {
                                        name: ing.name,
                                        quantity: ing.quantity,
                                        unit: ing.unit
                                    };
                                }
                            });
                        }
                    }
                }
            }

            // Convertir l'objet en tableau
            const suggestions = Object.values(shoppingList);

            // Afficher les suggestions
            const container = document.getElementById('suggestions-list');

            if (suggestions.length === 0) {
                container.innerHTML = `
                    <div class="suggestion-item">
                        <div class="suggestion-info">
                            <i class="fas fa-shopping-basket"></i>
                            <span>Planifiez vos recettes pour voir les suggestions d'achat</span>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = suggestions.map(item => `
                    <div class="suggestion-item">
                        <div class="suggestion-info">
                            <i class="fas fa-shopping-cart"></i>
                            <span><strong>${item.name}</strong> - ${item.quantity} ${item.unit}</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Ouverture d'une modal
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Fermeture du sélecteur de recettes
        function closeSelectorModal() {
            document.getElementById('recipe-selector-modal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Fermeture de la modal d'édition
        function closeEditModal() {
            document.getElementById('edit-recipe-modal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Affichage des notifications
        function showNotification(message, type = 'info') {
            // Création d'une notification temporaire
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;

            // Styles pour la notification
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 10px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                animation: slideInRight 0.3s ease-out;
                max-width: 400px;
                background: ${type === 'success' ? '#059669' : type === 'error' ? '#dc2626' : '#2563eb'};
            `;

            document.body.appendChild(notification);

            // Suppression automatique après 4 secondes
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
    </script>

    <!-- Styles pour les animations des notifications -->
    <style>
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</body>

</html>